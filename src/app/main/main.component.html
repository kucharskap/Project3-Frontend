<div class="columns">
  <div class="main-section column is-three-quarters">
    <h1 class="center">{{groups?.name}}: Subjects</h1>

    <div class="box search">
      <div class="field has-addons">
        <div class="control">
          <input class="input" type="text" placeholder="Search Group 1 Subjects" [(ngModel)]="search">
        </div>
        <div class="control">
          <a class="button is-info">
            Search
          </a>
        </div>
      </div>
    </div>
    <!-- add for each subject div below-->


    <a *ngFor="let subject of groups?.subjects | inputFilter : search" [routerLink]="['/g', groups._id, 'subject', subject._id]" class="box">
      <article class="media">
        <div class="media-content">
          <div class="content">
            <div class="left">
              <h4>
                <strong>{{subject?.name}}</strong>
              </h4>
              Tags:
              <span *ngFor="let keyword of subject?.keywords">{{keyword}} </span>
            </div>
            <div class="right">
              <p>{{statsBySubject[subject?._id]?.numberOfCards}} cards</p>
              <p>{{individualStats?.percentageComplete | number:'.0'}}% Complete</p>
              <!-- <p>{{statsBySubject[subject?._id]?.avePercentageComplete | number: ".0" }}% Complete</p> -->
            </div>

          </div>
        </div>
      </article>
    </a>

    <!-- <div *ngFor="let subject of groups?.subjects" class="box">
    <article class="media">
      <div class="media-content">
        <div class="content">
          <div class ="left">
              <h4 ><strong>{{subject.name}}</strong></h4>
          
              <span *ngFor="let keyword of subject.keywords">{{keyword}}</span>
              <! <p *ngIf="subjects">Tags: {{subjects?.tags}}</p> -->
    <!-- </div>
          <a [routerLink]="['/subject', subject._id]" class="button is-link right">View Flashcards</a>
        </div>
      </div>
    </article>
  </div> -->


    <!-- if admin show this below -->
    <div class="center admin" *ngIf="isAdmin">
      <p>Admin can see this:</p>
      <a class="button is-link" (click)="showAddSubForm()">Add Subject +</a>
      <a class="button is-link" (click)="showAddUserForm()">Add User +</a>
    </div>
  </div>

  <div class="column stats-box">
    <div>
      <h3 class="center">{{groups?.name}} Statistics</h3>
    </div>

    <div *ngFor="let subject of groups?.subjects">
        <h3>{{subject.name}}</h3>
<!-- {{statsBySubject[subject?._id]?.avePercentageComplete}}" -->
        <app-donut-chart [percentage]="getAverageCompleteForSubject(subject._id)"></app-donut-chart>
        <p>{{statsBySubject[subject?._id]?.avePercentageComplete | number: ".0" }}% Complete </p>
        <p>Average Card Rating: {{statsBySubject[subject?._id]?.aveAverageRating | number: ".1"}} </p>
        <p>Average Cards Viewed: {{statsBySubject[subject?._id]?.aveCardsViewed | number: ".0"}} </p>
        <p>Average Cards Mastered: {{statsBySubject[subject?._id]?.aveNumberCardsMastered | number: ".0"}}  </p>

        cardRatingsDistribution
    </div> 

  </div>


</div>

<div class="sign-up-window" *ngIf="addSubState">
  <div class="sign-up-pop">
    <h2> Subject adding</h2>
    <form (change)="chooseThisSub($event)">
      <label>Which subject do you want to add to your group ?
        <div class="field has-addons">
          <div class="control is-expanded">
            <div class="select is-fullwidth">
              <select name="country">
                <option *ngFor="let oneSub of subjects" value="{{oneSub?._id}}">{{oneSub?.name}}</option>
              </select>
            </div>
          </div>
          <div class="control">
            <button type="submit" class="button is-primary" (click)="addThisSub()">Choose</button>
          </div>
        </div>
      </label>
    </form>
  </div>
</div>

<div class="sign-up-window" *ngIf="addUserState">
  <div class="sign-up-pop columns">
    <div class="column is-half" >
      <div *ngFor="let one of allUsersWhoBelong"> {{one.username}} 
          <button (click)="deleteUserFromGroup(one._id)">Delete</button>
      </div>
    </div>
    <div class="column is-half">
      <h2> User adding</h2>
      <input type="text" name="username" [(ngModel)]="searchUser">
      <div *ngFor="let user of allUsersWhoDontBelong | userPipe : searchUser">
        <span>{{user.username}}</span>
        <button (click)="addUserToGroup(user._id)">Add</button>
      </div>
    </div>
    <button (click)="showAddUserForm()">Close</button>
  </div>
</div>

